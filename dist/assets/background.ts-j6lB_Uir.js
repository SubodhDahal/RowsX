async function f(){return(await chrome.tabs.query({active:!0}))[0]}async function d(){function a(c){const i=[];for(let n=0;n<c.length;n++){const l=c[n];for(let e=0;e<l.length;e++){const r=l[e];for(let t=0;t<r.colspan;t++)i[n]||(i[n]=[]),i[n].push({...r,colspan:1})}}for(let n=0;n<i.length;n++){const l=i[n];for(let e=0;e<l.length;e++){const r=l[e];for(let t=1;t<r.rowspan;t++)i[n+t]||(i[n+t]=[]),i[n+t].splice(e,0,{...r,rowspan:1})}}return i.map(n=>n.map(l=>l.value))}const s=[],u=Array.from(document.querySelectorAll("table")),o="tr",m="td,th";return u.map(c=>{let i=c.previousElementSibling?c.previousElementSibling.innerText.trim():"",n=c;for(;i===""||i.startsWith(".");){const l=n.querySelector("caption,h6,h5,h4,h3,h2,h1,title");l&&(i=l.innerText.replaceAll(`
`," ").trim()),n=n.parentElement}return s.push(i.replace("[edit]","")),Array.from(c.querySelectorAll(o)).map(l=>l?Array.from(l.querySelectorAll(m)).map(e=>{if(!e)return{value:"",colspan:1,rowspan:1};const r=+(e.getAttribute("rowspan")||1)||1,t=+(e.getAttribute("colspan")||1)||1;return{value:(e.innerText||"").replaceAll(`
`," ").replaceAll("	"," ").trim(),colspan:t,rowspan:r}}):[])}).map((c,i)=>({title:s[i],table:a(c)}))}async function g(a){const s=await f();let u=[];return a?u=await chrome.scripting.executeScript({target:{tabId:s.id},args:[a],func:o=>{function m(e,r){var p,h;const t=e.querySelector(r);return((h=(p=t==null?void 0:t.innerText)==null?void 0:p.replaceAll(`
`," "))==null?void 0:h.trim())??""}function y(e,r){const t=e.querySelector(r);return t?t.src:""}function c(e,r){const t=e.querySelector(r);return t?t.href:""}function i(e,r){const t=e.querySelector(r);if(!t)return"";const p=new URL(t.href);return p.origin+p.pathname}function n(e,r,t){switch(t){case"text":return m(e,r);case"image":return y(e,r);case"clean-url":return i(e,r);case"link":return c(e,r);default:return""}}const l=Array.from(document.querySelectorAll(o.listElementsQuery)).map(e=>o.elementParser.map(r=>n(e,r.query,r.type)));return[{title:o.header,table:[[...o.elementParser.map(e=>e.title)],...l]}]}}):u=await chrome.scripting.executeScript({target:{tabId:s.id},func:d}),u[0].result??[]}function q(a){return a.includes("ycombinator.com/companies")?{header:"YCombinator results",listElementsQuery:'[class*="_results_"] > a[class*="_company_"]',elementParser:[{title:"Logo",query:"img",type:"image"},{title:"Description",query:'[class*="_coDescription_"]',type:"text"},{title:"Company name",query:'[class*="_coName_"]',type:"text"},{title:"Location",query:'[class*="_coLocation_"]',type:"text"}]}:a.includes("linkedin.com/search")?{header:"Linkedin search results",listElementsQuery:".reusable-search__entity-result-list > li",elementParser:[{title:"Avatar",query:"img",type:"image"},{title:"Name",query:'.entity-result__title-text > .app-aware-link span[aria-hidden="true"]',type:"text"},{title:"Job",query:".entity-result__primary-subtitle",type:"text"},{title:"Location",query:".entity-result__secondary-subtitle",type:"text"},{title:"Profile url",query:".entity-result__title-text > .app-aware-link",type:"clean-url"}]}:a.includes("idealista.pt/comprar-")?{header:"Idealista search results",listElementsQuery:".item",elementParser:[{title:"Home",query:".item-link",type:"text"},{title:"Price",query:".item-price",type:"text"},{title:"Typology",query:".item-detail-char > .item-detail:nth-child(1)",type:"text"},{title:"Area",query:".item-detail-char > .item-detail:nth-child(2)",type:"text"},{title:"Description",query:".item-description",type:"text"},{title:"Link",query:".item-link",type:"link"}]}:null}async function b(){const a=await f(),s=q(a.url);return await g(s)}chrome.runtime.onMessage.addListener((a,s,u)=>(a==="rows-x:scrap"&&b().then(o=>u(o)),!0));
